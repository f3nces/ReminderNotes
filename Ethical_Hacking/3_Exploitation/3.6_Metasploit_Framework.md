# Metasploit Framework

[TOC]

## Metasploit

+ Open-source framework used for penetration testing and exploit development

```bash
#Recommended to use database for faster searching
systemctl start postgresql
msfdb init
```

### Core Commands

| Commands                     | Description                                                  |
| ---------------------------- | :----------------------------------------------------------- |
| **msfconsole**               | Launch metasploit console                                    |
| **msfupdate**                | Update Metasploit                                            |
| **set** <option> <value>     | Sets a context-specific variable to a value                  |
| **setg** <var> <value>       | Sets a global variable to a value                            |
| **get** <var>                | Gets the value of a context-specific variable                |
| **getg** <var>               | Gets the value of a global variable                          |
| **run**                      | Run the module                                               |
| **exploit**                  | Exploit                                                      |
| **sessions**                 | List current opened sessions                                 |
| **sessions -i** <session_id> | Resume a background session                                  |
| **save**                     | Used to store the settings/active datastores from Metasploit to a settings file |
| **spool**                    | Write console output into a file as well the screen          |
| **exit** \| **quit**         | Sair da consola                                              |
| **help** \| **?**            | Menu de ajuda                                                |



### Module Commands

| Commands            | Description                                                  |
| ------------------- | :----------------------------------------------------------- |
| **advanced**        | View advanced options for a specific module                  |
| **back**            | Return to back path                                          |
| **info** <module>   | View information about module. If inside module does not need the module name |
| **options**         | View module options                                          |
| **search** <term>   | Search for modules                                           |
| **show** <category> | Show different kinds of information                          |
| **use** <path>      | Select a module                                              |

+ Core Modules:
  + **Exploit** - Holds all of the exploit code
  + **Payload** - Contains the various bits of shellcode we send to have executed following exploitation
  + **Auxiliary** - Most commonly used in scanning and verification if machines are exploitable
  + **Post** - Provide activities like looting and pivoting
  + **Encoder** - Commonly utilized in payload obfuscation
  + **NOP** - Used with buffer overflow and ROP attacks



### Database Commands

| Commands     | Description                                        |
| ------------ | -------------------------------------------------- |
| **db_nmap**  | Executes nmap and records the output automatically |
| **hosts**    | List all hosts in the database                     |
| **services** | List all services in the database                  |
| **vulns**    | List all vulnerabilities in the database           |



### Important Modules

| Module Name   | Description                                  |
| ------------- | -------------------------------------------- |
| **bypassuac** | Bypass UAC restriction on a Windows machine  |
| **hashdump**  | Dumps password database of a Windows machine |





## Meterpreter

+ Powerful **shell** which runs on Android, Java, Linux, PHP, Python and Windows vulnerable applications and services
+ **Meterpreter Session** - advanced shell on the target machine

| Commands                             | Description                                                  |
| ------------------------------------ | ------------------------------------------------------------ |
| **background**                       | Switch from a Meterpreter session to the console             |
| **sysinfo**                          | Retrieve information about the exploited machine (name, OS, language, architecture) |
| **ifconfig** <or> **ipconfig**       | Print network configuration                                  |
| **route**                            | Routing information                                          |
| **getuid**                           | Get user running the process exploited                       |
| **getsystem**                        | Runs a privilege escalation routine on the target machine (New Windows may need to run **bypassuac** module) |
| **getprivs**                         | Privileges of current user                                   |
| **ls**                               | List the content of a directory                              |
| **search**                           | Search files                                                 |
| **execute**                          | Execute a command on a remote host                           |
| **pwd**                              | Prints working directory                                     |
| **cd** <path>                        | Changes directory (Need to **escape backslashes**)           |
| **upload** \| **download** <path>    | Upload or download files                                     |
| **shell**                            | Run a standard OS shell                                      |
| **ps**                               | Show list of processes                                       |
| **getpid**                           | Get current process ID                                       |
| **migrate** <process_id>             | Change to another process ID to hardening identification     |
| **?** \|**help** \| <command> **-h** | Help information                                             |

```bash
#---------Post modules from Metasploit-------------------#

#Check for various exploits
run post/multi/recon/local_exploit_suggester

#Determine if we're in a VM
run post/windows/gather/checkvm

#Try forcing RDP to be available
run post/windows/manage/enable_rdp
```



## msfvenom

+ 